---
title: "資料傳輸 | Microsoft Docs"
description: "了解 Configuration Manager 如何在站台之間移動資料，以及如何管理資料在您網路上的傳輸。"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: dc526e8d-fac3-4bb5-b206-03ad29b0ae11
caps.latest.revision: 12
author: Brenduns
ms.author: brenduns
manager: angrobe
translationtype: Human Translation
ms.sourcegitcommit: bfe77a45b5f781611c343e06d1289add7abd2dfb
ms.openlocfilehash: bf0fdc8d4b4a72760b2cfb91231378a17df01594
ms.lasthandoff: 03/01/2017


---
# <a name="data-transfers-between-sites-in-system-center-configuration-manager"></a>System Center Configuration Manager 中的站台間資料傳輸

*適用於：System Center Configuration Manager (最新分支)*

System Center Configuration Manager 會使用**檔案複寫**與**資料庫複寫**在站台之間傳送不同類型的資訊。 了解 Configuration Manager 如何在站台之間移動資料，以及如何管理資料在您網路上的傳輸。  


## <a name="bkmk_fileroute"></a> File-based replication  
Configuration Manager 會使用檔案複寫在階層中網站間傳送檔案資料。 這項資料包括您想要部署至子站台中發佈點的應用程式和套件，以及傳輸至父站台然後進行處理的未經處理探索資料記錄。  

站台之間以檔案為主的通訊會透過 TCP/IP 連接埠 445 來使用「伺服器訊息區」(SMB) 通訊協定。 您可以指定頻寬節流和脈衝模式來控制透過網路傳輸的資料量，而且可以使用排程來控制透過網路傳送資料的時間。  

### <a name="bkmk_routes"></a> 檔案複寫路由  
下列資訊可協助您設定和使用檔案複寫路由。  

#### <a name="file-replication-route"></a>檔案複寫路由

每個檔案複寫路由都會識別可傳送以檔案為基礎之資料的目的地網站。 每個站台都支援連接至特定目的地站台的一個檔案複寫路由。  

您可以變更下列檔案複寫路由設定：  

-  **檔案複寫帳戶**。 此帳戶會連線至目的地站台，以及將資料寫入該站台的 **SMS_Site** 共用。 寫入此共用的資料會由接收網站處理。 根據預設，將站台新增至階層時，Configuration Manager 會將新站台的站台伺服器電腦帳戶指派為該站台的檔案複本帳戶。 此帳戶會接著新增至目的地站台的 **SMS_SiteToSiteConnection_&lt;站台碼\>** 群組，這是電腦上授與 SMS_Site 共用存取權限的本機群組。 您可以將此帳戶變更為 Windows 使用者帳戶。 如果您變更帳戶，請確定將新帳戶新增至目的地站台的 **SMS_SiteToSiteConnection_&lt;站台碼\>** 群組。  

    > [!NOTE]  
    >  次要網站一律使用次要網站伺服器的電腦帳戶做為 [檔案複寫帳戶] 。  

-  **排程**。 您可以設定每個檔案複寫路由的排程，限制可傳輸至目的地站台的資料類型和時間。  
-  **速率限制**。 您可以指定每個檔案複寫路由的速率限制，以控制站台將資料傳輸至目的地站台時使用的網路頻寬：  

    -  使用 [脈衝模式]  指定傳送至目的地網站的資料區塊大小。 您也可以指定傳送每個資料區塊之間的時間延遲。 如果您必須經由非常低頻寬的網路連線將資料傳送至目的地站台，請使用此選項。 例如，您可能限制每五秒傳送 1 KB 的資料，而非每三秒 1 KB，無論於特定時間的連結速度或其使用情形為何。
    -  使用 [限制為每小時最大傳送速率]  ，讓網站僅使用您指定的時間百分比傳送資料至目的地網站。 使用此選項時，Configuration Manager 不會識別網路的可用頻寬，而會將可傳送資料的時間細分成時間片段。 然後資料會在一小段時間內傳送，下一段時間則不傳送資料。 例如，如果最大速率設為 **50%**，則 Configuration Manager 會在沒有資料傳輸時的一段相等時間間隔之後，傳輸一定時間量的資料。 不會管理實際資料量大小或資料區塊大小。 只會管理傳送資料的時間長度。  

        > [!CAUTION]  
        > 根據預設，網站最多可以使用三個 [並行傳送]  將資料傳送至目的地網站。 當您啟用檔案複寫路由的速率限制時，傳送資料至該網站的 [並行傳送]  會限制為一個。 這項限制在 [限制可用的頻寬 (%)]  設為 [100%] 時也適用。 例如，如果您針對寄件者使用預設設定，這樣就會將傳送至目的地站台的傳輸速率減少為預設容量的三分之一。  

-  您可以在兩個次要網站之間設定檔案複寫路由，在網站之間路由傳送檔案內容。  

若要管理檔案複寫路由，請在 [系統管理] 工作區中展開 [階層設定] 節點，然後選取 [檔案複寫]。  

#### <a name="sender"></a>傳送者

每個網站都有一位傳送者。 傳送者會管理從一個網站到目的地網站的網路連線，並可以同時建立和多個網站間的連線。 為了連線至網站，傳送者會使用至該網站的檔案複寫路由，以識別用來建立網路連線的帳戶。 傳送者也會使用這個帳戶將資料寫入目的地站台的 SMS_Site 共用。  

根據預設，傳送者會使用多個 [並行傳送] \(一般視為執行緒)，將資料寫入目的地網站。 每個並行傳送 (或執行緒) 可以將不同的檔案物件傳輸到目的地網站。 根據預設，傳送者開始傳送物件時，傳送者會繼續寫入該物件的資料區塊，直到整個物件傳送完畢為止。 物件的所有資料都傳送完畢後，新的物件就會開始在該執行緒上傳送。  

您可以為傳送者變更以下設定：  

-  **並行傳送上限**。 根據預設，每個站台都會使用五個並行傳送，而將資料傳送至任一目的地站台時可以使用三個。 增加此數量時，因為 Configuration Manager 可以同時傳輸更多檔案，所以您可以增加站台間資料的輸送量。 不過，增加數量也會增加對網站間網路頻寬的需求。  

-  **重試設定**。 根據預設，每個站台都會重試有問題的連線兩次，每次連線嘗試間會有一分鐘的延遲。 您可以修改站台進行連線嘗試的次數，以及嘗試之間等候的時間長度。  

若要管理站台的傳送者，請在 [系統管理] 工作區中展開 [站台設定] 節點，並選取 [站台] 節點，然後選取您要管理之站台的 [內容]。 選取 [傳送者] 索引標籤，變更傳送者設定。  

## <a name="bkmk_dbrep"></a> Database replication  
Configuration Manager 資料庫複寫會使用 SQL Server 來傳輸資料，以及合併站台資料庫中的變更與儲存在階層中其他站台資料庫中的資訊。 請注意下列有關資料庫複寫的事項︰

-  所有站台都共用相同資訊。  
-  在階層中安裝站台時，會在新站台與其指定的父站台間自動建立資料庫複寫。  
-  網站安裝完成後，就會自動開始進行資料庫複寫。  

當您將新的站台新增至階層時，Configuration Manager 會在新站台建立一般資料庫。 接著，父站台會建立其資料庫中相關資料的快照，並藉由以檔案為基礎的複寫，將該快照傳輸到新站台。 然後，新站台會使用 SQL Server 大量複製程式 (BCP)，將資訊載入 Configuration Manager 資料庫的本機複本中。 載入快照後，每個網站都會和其他網站一起執行資料庫複寫。  

為了在網站間複寫資料，Configuration Manager 會使用其擁有的資料庫複寫服務。 資料庫複寫服務會使用 SQL Server 變更追蹤來監視本機站台資料庫的變更，然後使用 SQL Server Service Broker (SSB) 將變更複寫至其他站台。 根據預設，這個程序會使用 TCP/IP 連接埠 4022。  

Configuration Manager 會將資料庫複寫所複寫的資料分門別類到不同的複寫群組內。 請注意下列有關複寫群組的事項︰

-  每個複寫群組都有各自固定的複寫排程，這會決定將群組中的資料變更複寫至其他網站的頻率。  

     例如，針對以角色為基礎之系統管理設定的變更會快速地複寫到其他站台，確保能儘快執行這些變更。 而較低優先順序的設定變更 (如要求安裝新的次要站台) 沒有急迫複寫的需求。 可能需要數分鐘的時間，才會將新站台要求送達目的地主要站台。  

-   您可以修改下列資料庫複寫設定：  

    -  **資料庫複寫連結**。 控制特定流量何時周遊網路。  
    -  **分散式檢視**。 變更複寫連結的設定，藉以針對所選站台資料在管理中心網站所提出的要求，讓這些要求從子主要站台資料庫直接存取該站台資料。  
    -  **排程**。 指定何時使用複寫連結，以及何時複寫不同類型的站台資料。  
    -  **摘要**。 變更可周遊複寫連結之網路流量的資料摘要設定。 根據預設，摘要每 15 分鐘產生一次，並且在資料庫複寫的報表中使用。  
    -  **資料庫複寫閾值**。 定義何時將連結報告為降級或失敗。 您也可以設定 Configuration Manager 何時發出有關具有降級或失敗狀態之複寫連結的警示。  

Configuration Manager 會將資料庫複寫所複寫的資料分類為**全域資料**或**站台資料**。 發生資料庫複寫時，全域資料和網站資料的變更都會傳輸到所有的資料庫複寫連結。 全域資料可以複寫至父或子站台。 站台資料只能複寫至父站台。 第三種資料類型 (即本機資料) 不會複寫至其他站台。 本機資料是其他站台不需要的資訊。 請注意下列有關資料類型的事項︰  

-  **全域資料**。 全域資料是指會複寫到整階層中所有網站並由系統管理員建立的物件，但次要網站只會接收全域資料中全域 Proxy 資料這部分。 全域資料包括軟體部署、軟體更新、收集定義和以角色為基礎的系統管理安全性範圍。 系統管理員可以在管理中心網站和主要網站上建立全域資料。  
-  **站台資料**。 站台資料是指 Configuration Manager 主要站台和用戶端回報至主要站台時建立的作業資訊。 網站資料會複寫到管理中心網站，但不會複寫到其他主要網站。 站台資料包括硬體清查資料、狀態訊息、警示和以查詢為基礎的集合結果。 您只能從資料最初來源的管理中心網站和主要站台檢視站台資料。 且只能在建立該資料的主要網站上修改網站資料。  

     所有站台資料都會複寫到管理中心網站。 管理中心網站會執行整個站台階層的系統管理和報告。  

下列各節詳述您可以為管理資料庫複寫所做的設定。  

### <a name="bkmk_Dblinks"></a> 資料庫複寫連結  
在階層中安裝新站台時，Configuration Manager 會在父站台與新站台之間自動建立資料庫複寫連結。 建立單一連結，以連線兩個站台。  

您可以變更每個資料庫複寫連結的設定，協助您控制跨複寫連結的資料傳輸。 每個複寫連結支援個別的設定。 資料庫複寫連結的控制項包括以下項目：  

-  停止將所選站台資料從主要站台複寫到管理中心網站，讓管理中心網站可以直接從主要站台資料庫存取此資料。  
-  排定將選取的站台資料從子主要站台傳輸到管理中心網站。
-  定義判斷資料庫複寫連結是否降級或失敗的設定。
-  指定何時發出複寫連結失敗的警示。
-  指定 Configuration Manager 摘要使用複寫連結之複寫流量資料的頻率。 此資料會用在報告中。

若要設定資料庫複寫連結，您可以在 Configuration Manager 主控台的 [資料庫複寫] 節點編輯連結的內容。 此節點會同時出現在 [監視] 工作區和 [系統管理] 工作區的 [階層設定] 節點上。 您可以從複寫連結的父網站或子網站編輯複寫連結。  

> [!TIP]  
> 您可以從其中一個工作區的 [資料庫複寫]  節點編輯資料庫複寫連結。 不過，使用 [監視] 工作區中的 [資料庫複寫] 節點時，您也可以檢視複寫連結的資料庫複寫狀態，以及存取 [複寫連結分析師] 工具，以協助您調查資料庫複寫的問題。  

如需如何設定複寫連結的詳細資訊，請參閱 [網站資料庫複寫控制](#BKMK_DBRepControls)。 如需如何監視複寫的詳細資訊，請參閱[監視 System Center Configuration Manager 的階層及複寫基礎結構](../../../core/servers/manage/monitor-hierarchy-and-replication-infrastructure.md)主題中的[如何監視資料庫複寫連結和複寫狀態](../../../core/servers/manage/monitor-hierarchy-and-replication-infrastructure.md#BKMK_MonitorRepLinksAndStatuss)。  

使用下列各節中的資訊，協助您規劃資料庫複寫連結。  

### <a name="bkmk_distviews"></a> 分散式檢視  
透過分散式檢視，針對所選站台資料在管理中心網站所提出的要求，可從子主要站台資料庫直接存取該站台資料。 直接存取會取代從主要站台將該站台資料複寫到管理中心網站的需求。 由於每個複寫連結和其他複寫連結各自獨立，因此您僅能在您選擇的複寫連結上使用分散式檢視。 您無法在主要站台與次要站台之間使用分散式檢視。  

分散式檢視可提供以下優勢：  

-  降低處理管理中心網站和主要站台之資料庫變更方面的 CPU 負載
-  降低經由網路傳輸到管理中心網站的資料量
-  改善裝載管理中心網站資料庫之 SQL Server 的效能
-  降低管理中心網站資料庫使用的磁碟空間

如果主要網站在網路上和管理中心網站十分接近，且兩個站台持續開啟並保持連線，則請考慮使用分散式檢視。 這是因為分散式檢視會以每個站台上 SQL Server 間的直接連線，取代站台間所選取資料的複寫。 每次在管理中心網站要求此資料時，就會進行直接連線。 一般來說，如果您執行報表或查詢、於資源總管內檢視資訊，以及依據集合評估 (針對含有以站台資料為基礎之規則的集合) 來檢視資訊，皆可發出啟用分散式檢視的資料要求。  

根據預設，每個複寫連結都會關閉分散式檢視。 當您開啟複寫連結的分散式檢視時，可以選取將不會透過該連結複寫至管理中心網站的站台資料。 管理中心網站會直接從共用連結的子主要站台資料庫存取此資料。 您可以針對分散式檢視設定以下網站資料類型：  

-  來自用戶端的硬體清查資料
-  來自用戶端的軟體清查和計量資料
-  用戶端、主要網站和所有次要網站的狀態訊息

您也可以選擇讓檢視 Configuration Manager 主控台或報告內資料的系統管理員無法看到分散式檢視。 當發出啟用分散式檢視的資料要求時，裝載管理中心網站資料庫的 SQL Server 會直接存取子主要站台的 SQL Server 來擷取資訊。 例如，當您使用管理中心網站的 Configuration Manager 主控台，從兩個網站請求有關硬體清查的資訊，但只有一個網站擁有啟用分散式檢視之硬體清查的情況時， 來自未設定分散式檢視之網站的用戶端清查資訊，會經由管理中心網站的資料庫進行擷取。 而來自已設定分散式檢視之站台的用戶端清查資訊，可經由子主要站台的資料庫進行存取。 此資訊會顯示在 Configuration Manager 主控台或報表中，而不需識別來源。  

只要複寫連結具備啟用分散式檢視的資料類型，子主要站台就不會將資料複寫至管理中心網站。 一旦您關閉某個資料類型的分散式檢視，子主要站台就會恢復將資料複寫至管理中心網站，作為一般資料複寫的一部分。 不過，包含此資料的複寫群組必須在主要站台與管理中心網站間重新初始化，才能於管理中心網站上看到此資料。 同樣地，在您解除安裝已開啟分散式檢視的主要站台之後，管理中心網站必須先完成其資料的重新初始化，您才能存取在管理中心網站上啟用分散式檢視的資料。  

> [!IMPORTANT]  
> 在站台階層的任何複寫連結上使用分散式檢視時，您必須先關閉所有複寫連結的分散式檢視，再解除安裝任何主要站台。 如需詳細資訊，請參閱 [Uninstall a primary site that is configured with distributed views](../../../core/servers/deploy/install/uninstall-sites-and-hierarchies.md#BKMK_UninstallPrimaryDistViews)。  

#### <a name="prerequisites-and-limitations-for-distributed-views"></a>分散式檢視的先決條件和限制  

-  您只有在管理中心網站與主要站台之間的複寫連結上才能使用分散式檢視。
- 管理中心網站必須使用 SQL Server 企業版。 主要站台沒有這項需求。
-  管理中心網站可以只有一個已安裝之 SMS 提供者的執行個體，且該執行個體必須安裝在網站資料庫伺服器上。 若要支援在管理中心網站上啟用 SQL Server 所需的 Kerberos 驗證以存取子主要站台上的 SQL Server，就必須具備這項條件。 對於子主要網站上的 SMS 提供者，沒有任何限制。
-  管理中心網站上可以只安裝一個 SQL Server Reporting Services 點，且必須位於網站資料庫伺服器上。 若要支援在管理中心網站上啟用 SQL Server 所需的 Kerberos 驗證以存取子主要站台上的 SQL Server，就必須具備這項條件。
-  網站資料庫無法裝載在 SQL Server 叢集上。
-  站台資料庫無法裝載在 SQL Server AlwaysOn 可用性群組上。
-  管理中心網站的資料庫伺服器電腦帳戶，需要主要站台之站台資料庫的 [讀取] 權限。

> [!IMPORTANT]  
>  分散式檢視及資料複寫排程，都是資料庫複寫連結的互斥設定。  

### <a name="BKMK_schedules"></a> 資料庫複寫連結上的站台資料傳送排程  
為了協助您控制從子主網站複寫網站資料到管理中心網站所用的網路頻寬，您可以排定何時使用複寫連結，並指定何時複寫不同類型的網站資料。 您可以控制主要網站何時複寫狀態訊息、清查和計量資料。 次要網站的資料庫複寫連結不支援網站資料的排程。 無法排定全域資料傳送的時程。  

設定資料庫複寫連結排程時，您可以限制只從主要網站將選定網站資料傳送到管理中心網站，並且可以設定複寫不同類型網站資料的不同時間。  

> [!IMPORTANT]  
> 分散式檢視及資料複寫排程，都是資料庫複寫連結的互斥設定。  

### <a name="BKMK_SummarizeDBReplication"></a> 資料庫複寫流量摘要  
每個站台都會定期將有關周遊站台的資料庫複寫連結之網路流量的資料，製作成摘要。 摘要資料可用於資料庫複寫報表中。 複寫連結上的兩個網站，都會將周遊複寫連結的網路流量製做為摘要。 資料的摘要是由裝載網站資料庫的 SQL Server 所執行。 製作資料摘要之後，此資訊即會複寫至其他站台作為全域資料。  

根據預設，每隔 15 分鐘便會摘要一次。 若要修改網路流量摘要的頻率，請編輯資料庫複寫連結內容中的 [摘要間隔]。 摘要的頻率會影響您在資料庫複寫報表中檢視的資訊。 您可以選擇 5 分鐘與 60 分鐘之間的間隔。 當您增加摘要的頻率時，即會增加複寫連結上各站台的 SQL Server 處理負載。  

### <a name="BKMK_DBRepThresholds"></a> 資料庫複寫閾值  
資料庫複寫閾值可定義資料庫複寫連結狀態會在何時報告為降級或失敗。 根據預設，當有任何一個複寫群組連續 12 次都無法完成複寫時，即會將連結設為降級狀態。 當有任何複寫群組連續 24 次都無法複寫時，則會將連結設為失敗狀態。  

您可以指定自訂值以微調 Configuration Manager 在何時將複寫連結報告為已降級或失敗。 調整 Configuration Manager 在何時報告各個資料庫複寫連結狀態可協助您準確地監視整個資料庫複寫連結的資料庫複寫健全狀況。  

由於可能會有一個或少數複寫群組複寫失敗，而其他複寫群組卻繼續成功複寫的情況，因此請在第一次報告降級狀態時，即檢閱複寫連結的複寫狀態。 如果有特定的複寫群組週期性地出現延遲，而這些延遲並未造成任何問題，或者網站之間的網路連結可用的頻寬過低時，請考慮修改連結降級或失敗狀態的重試次數值。 您可增加連結設為降級或失敗之前的重試次數，藉此減少已知問題的錯誤警告，並更加準確地追蹤連結狀態。  

您也可將各複寫群組的複寫同步間隔納入考慮，以了解該群組複寫的頻率。 若要檢視複寫群組的 [同步處理間隔]，請在 [監視] 工作區的 [資料庫複寫] 節點上選取複寫連結的 [複寫詳細資料] 索引標籤。  

如需如何監視資料庫複寫的詳細資訊，包含如何檢視複寫狀態，請參閱[監視 System Center Configuration Manager 的階層及複寫基礎結構](../../../core/servers/manage/monitor-hierarchy-and-replication-infrastructure.md)主題中的[如何監視資料庫複寫連結和複寫狀態](../../../core/servers/manage/monitor-hierarchy-and-replication-infrastructure.md#BKMK_MonitorRepLinksAndStatuss)。  

如需設定資料庫複寫閾值的資訊，請參閱[站台資料庫複寫控制](#BKMK_DBRepControls)。  

## <a name="BKMK_DBRepControls"></a> 站台資料庫複寫控制  
您可以變更每個站台資料庫的設定，協助您控制用於資料庫複寫的網路頻寬。 這些設定只適用於您在其中進行設定的站台資料庫。 站台將資料庫複寫的任何資料複寫到任何其他站台時，一律會使用這些設定。  

下列是您可針對每個站台資料庫修改的複寫控制：  

-  變更 SSB 連接埠。  
-  設定複寫失敗觸發站台重新初始化其站台資料庫複本之前的等待時間。  
-  將網站資料庫設定為壓縮由資料庫複寫所複寫的資料。 只會壓縮網站之間傳送的資料，並不會壓縮儲存在任一網站之網站資料庫中的資料。  

若要變更站台資料庫的複寫控制項設定，請在 Configuration Manager 主控台的 [資料庫複寫] 節點上編輯站台資料庫的內容。 此節點會出現在 [系統管理]  工作區中的 [階層設定]  節點之下，也會出現在 [監視工作區] 中。 若要編輯站台資料庫的內容，請選取站台之間的複寫連結，然後開啟 [父資料庫內容] 或 [子資料庫內容]。  

> [!TIP]  
> 您可以從任一工作區的 [資料庫複寫]  節點，設定資料庫複寫控制。 不過，當您使用 [監視] 工作區中的 [資料庫複寫] 節點時，也可以檢視複寫連結的資料庫複寫狀態，並且存取 [複寫連結分析師] 工具，以協助調查複寫問題。  

